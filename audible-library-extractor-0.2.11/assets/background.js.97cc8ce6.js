var i=!1,u=[],n;chrome.storage.local.get(["extras"]).then(e=>{var t;n=(t=e==null?void 0:e.extras)==null?void 0:t.galleryUrl});chrome.runtime.onMessage.addListener(function(e,t){e.pageAction==!0&&!chrome.runtime.lastError&&chrome.action.setIcon({tabId:t.tab.id,path:"assets/icons/16.png"}).then(function(){u.push(t.tab.id)})});chrome.action.onClicked.addListener(e=>{chrome.tabs.query({active:!0,currentWindow:!0}).then(t=>{var r=t[0];chrome.tabs.sendMessage(r.id,{iconClicked:!0,tab:r})})});chrome.runtime.onMessage.addListener(async(e,t)=>{e.action==="refresh"?chrome.tabs.update(t.tab.id,{url:e.url}):e.action==="newPage"?chrome.tabs.create({url:e.url,active:!0,index:t.tab.index+1}):e.action==="openOutput"?(chrome.tabs.update(t.tab.id,{url:e.url}),chrome.tabs.create({url:n||"./gallery.html",active:!0,index:t.tab.index+1}),c()):e.action==="openImageEditor"?chrome.tabs.create({url:"./wallpaper-creator.html?src=gallery",active:!0,index:t.tab.index+1}):e.action==="changeGalleryUrl"?(n=e.url,c()):e.action==="rebuild-context-menu"&&c()});chrome.tabs.onActivated.addListener(e=>{chrome.runtime.lastError||u.indexOf(e.tabId)>-1||chrome.action.setIcon({tabId:e.tabId,path:"assets/icons-gray/16.png"}).then(function(){})});c();function c(){chrome.storage.local.get(["chunks","extras"]).then(e=>{var s;const t=(e==null?void 0:e.chunks)||[];t.length>0;const r=t.lastIndexOf("books")>-1,o=t.lastIndexOf("wishlist")>-1;i=(s=e==null?void 0:e.extras)==null?void 0:s["domain-extension"],e=null,chrome.contextMenus.removeAll();const a={id:"ale-to-audible",title:"1. Audible"+i+"/library",contexts:["all"]};i||(a.title="1. Audible.com/library (placeholder)"),chrome.contextMenus.create(a);const l={id:"ale-to-gallery",title:"2. Extension gallery",contexts:["all"]};r||o||(l.enabled=!1,l.title=l.title+" (available after extraction)"),chrome.contextMenus.create(l),chrome.contextMenus.create({id:"separator-1",type:"separator",contexts:["all"]}),chrome.contextMenus.create({id:"ale-to-docs",title:"3. Documentation",contexts:["all"]}),chrome.contextMenus.create({id:"ale-to-github",title:"4. Github project page",contexts:["all"]}),chrome.contextMenus.create({id:"ale-to-github-issues",title:"5. Github issues",contexts:["all"]}),chrome.contextMenus.create({id:"ale-to-github-discussions",title:"6. Github discussions",contexts:["all"]})})}chrome.contextMenus.onClicked.addListener(h);function h(e,t){var r={active:!0,index:t.index+1,openerTabId:t.id};e.menuItemId==="ale-to-audible"?i?(r.url="https://audible"+i+"/library/titles?ipRedirectOverride=true&overrideBaseCountry=true",chrome.tabs.create(r)):chrome.storage.local.get(["extras"]).then(o=>{var a;i=(a=o==null?void 0:o.extras)==null?void 0:a["domain-extension"],r.url="https://audible"+(i||".com")+"/library/titles?ipRedirectOverride=true&overrideBaseCountry=true",chrome.tabs.create(r)}):e.menuItemId==="ale-to-gallery"?(r.url=n||"./gallery.html",chrome.tabs.create(r)):e.menuItemId==="ale-to-docs"?(r.url="https://joonaspaakko.gitbook.io/audible-library-extractor/",chrome.tabs.create(r)):e.menuItemId==="ale-to-github"?(r.url="https://github.com/joonaspaakko/audible-library-extractor",chrome.tabs.create(r)):e.menuItemId==="ale-to-github-issues"?(r.url="https://github.com/joonaspaakko/audible-library-extractor/issues",chrome.tabs.create(r)):e.menuItemId==="ale-to-github-discussions"&&(r.url="https://github.com/joonaspaakko/audible-library-extractor/discussions",chrome.tabs.create(r))}
